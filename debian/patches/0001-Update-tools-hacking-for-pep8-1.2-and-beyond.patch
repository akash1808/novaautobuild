From 54ad73dd9a9cf429e36d4a5288206adb308aa367 Mon Sep 17 00:00:00 2001
From: Joe Gordon <jogo@cloudscaling.com>
Date: Mon, 9 Jul 2012 16:03:14 -0700
Subject: [PATCH] Update tools hacking for pep8 1.2 and beyond

Based on https://github.com/jcrocholl/pep8/commit/b9f72b16011aac981ce9e3a47fd0ffb1d3d2e085

Change-Id: Icd776edd1d7b9987833167dcf04015109ffc7c17
---
 tools/hacking.py    |   12 +++++++-----
 tools/test-requires |    2 +-
 tox.ini             |    4 ++--
 3 files changed, 10 insertions(+), 8 deletions(-)

diff --git a/tools/hacking.py b/tools/hacking.py
index 2d8ce92..d1743be 100755
--- a/tools/hacking.py
+++ b/tools/hacking.py
@@ -88,7 +88,7 @@ def nova_except_format(logical_line):
     N201
     """
     if logical_line.startswith("except:"):
-        return 6, "NOVA N201: no 'except:' at least use 'except Exception:'"
+        yield 6, "NOVA N201: no 'except:' at least use 'except Exception:'"
 
 
 def nova_except_format_assert(logical_line):
@@ -99,7 +99,7 @@ def nova_except_format_assert(logical_line):
     N202
     """
     if logical_line.startswith("self.assertRaises(Exception"):
-        return 1, "NOVA N202: assertRaises Exception too broad"
+        yield 1, "NOVA N202: assertRaises Exception too broad"
 
 
 def nova_one_import_per_line(logical_line):
@@ -117,7 +117,7 @@ def nova_one_import_per_line(logical_line):
     if (pos > -1 and (parts[0] == "import" or
                       parts[0] == "from" and parts[2] == "import") and
         not is_import_exception(parts[1])):
-        return pos, "NOVA N301: one import per line"
+        yield pos, "NOVA N301: one import per line"
 
 _missingImport = set([])
 
@@ -191,7 +191,9 @@ def nova_import_module_only(logical_line):
             (len(split_line) == 2 or
             (len(split_line) == 4 and split_line[2] == "as"))):
         mod = split_line[1]
-        return importModuleCheck(mod)
+        rval = importModuleCheck(mod)
+        if rval != None:
+            yield rval
 
     # TODO(jogo) handle "from x import *"
 
@@ -348,7 +350,7 @@ def nova_localization_strings(logical_line, tokens):
         map(gen.send, tokens)
         gen.close()
     except LocalizationError as e:
-        return e.args
+        yield e.args
 
 #TODO(jogo) Dict and list objects
 
diff --git a/tools/test-requires b/tools/test-requires
index 0e230fc..01cbbe1 100644
--- a/tools/test-requires
+++ b/tools/test-requires
@@ -5,5 +5,5 @@ coverage
 mox==0.5.3
 nose
 openstack.nose_plugin>=0.7
-pep8==1.1
+pep8==1.2
 sphinx>=1.1.2
diff --git a/tox.ini b/tox.ini
index 4e1864d..9ba6bd6 100644
--- a/tox.ini
+++ b/tox.ini
@@ -17,8 +17,8 @@ commands = nosetests {posargs}
 downloadcache = ~/cache/pip
 
 [testenv:pep8]
-deps = pep8==1.1
-commands = python tools/hacking.py --ignore=N4 --repeat --show-source --exclude=.venv,.tox,dist,doc,*egg .
+deps = pep8==1.2
+commands = python tools/hacking.py --ignore=N4,E12 --repeat --show-source --exclude=.venv,.tox,dist,doc,*egg .
 
 [testenv:cover]
 setenv = NOSE_WITH_COVERAGE=1
-- 
1.7.10.4

